<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="Window.xaml"/>
        <ResourceDictionary Source="Items.xaml"/>
    </ResourceDictionary.MergedDictionaries>


    <SolidColorBrush x:Key="TreeView.Background"                 Color="{DynamicResource Control1}"/>
    <SolidColorBrush x:Key="TreeView.Border"                     Color="{DynamicResource Control2}"/>

    <SolidColorBrush x:Key="TreeView.Inactive.Background"        Color="{DynamicResource Control1}"/>
    <SolidColorBrush x:Key="TreeView.Inactive.Border"            Color="{DynamicResource Control2}"/>

    <Style TargetType="{x:Type TreeView}">
        <Setter Property="Background"                                 Value="{DynamicResource TreeView.Background}"/>
        <Setter Property="BorderBrush"                                Value="{DynamicResource TreeView.Border}"/>
        <Setter Property="Foreground"                                 Value="{DynamicResource Window.Active.Foreground}"/>
        <Setter Property="BorderThickness"                            Value="1"/>
        <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="auto"/>
        <Setter Property="ScrollViewer.VerticalScrollBarVisibility"   Value="auto"/>
        <Setter Property="ScrollViewer.CanContentScroll"              Value="true"/>
        <Setter Property="ScrollViewer.PanningMode"                   Value="Both"/>
        <Setter Property="Stylus.IsFlicksEnabled"                     Value="False"/>
        <Setter Property="VerticalContentAlignment"                   Value="Center"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type TreeView}">
                    <Border x:Name="Bd" 
                            BorderBrush="{TemplateBinding BorderBrush}" 
                            BorderThickness="{TemplateBinding BorderThickness}"
                            Background="{TemplateBinding Background}" 
                            Padding="0" 
                            SnapsToDevicePixels="True"
                            CornerRadius="4">
                        <ScrollViewer CanContentScroll="False" HorizontalScrollBarVisibility="Auto" Foreground="{TemplateBinding Foreground}">
                            <ItemsPresenter/>
                        </ScrollViewer>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsEnabled" Value="false">
                            <Setter Property="Background"  Value="{DynamicResource TreeView.Inactive.Background}"/>
                            <Setter Property="BorderBrush" Value="{DynamicResource TreeView.Inactive.Border}"/>
                            <Setter Property="Foreground"  Value="{DynamicResource Window.Active.Foreground.Disabled}"/>
                        </Trigger>
                        <MultiTrigger>
                            <MultiTrigger.Conditions>
                                <Condition Property="IsGrouping" Value="true"/>
                                <Condition Property="VirtualizingPanel.IsVirtualizingWhenGrouping" Value="false"/>
                            </MultiTrigger.Conditions>
                            <Setter Property="ScrollViewer.CanContentScroll" Value="false"/>
                        </MultiTrigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <Style TargetType="{x:Type TreeViewItem}">
        <Setter Property="SnapsToDevicePixels"        Value="True"/>
        <Setter Property="Padding"                    Value="4, 1"/>
        <Setter Property="HorizontalContentAlignment" Value="{Binding HorizontalContentAlignment, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"/>
        <Setter Property="VerticalContentAlignment"   Value="{Binding VerticalContentAlignment  , RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"/>
        <Setter Property="Background"                 Value="Transparent"/>
        <Setter Property="BorderBrush"                Value="Transparent"/>
        <Setter Property="BorderThickness"            Value="1"/>
        <Setter Property="Foreground"                 Value="{DynamicResource Window.Active.Foreground}"/>

        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type TreeViewItem}">
                    <ControlTemplate.Resources>
                        <Style x:Key="TreeViewNodeStyle" TargetType="{x:Type ToggleButton}">
                            <Setter Property="Foreground" Value="{DynamicResource Window.Active.Foreground.Disabled}"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="{x:Type ToggleButton}">
                                        <TextBlock x:Name="Arrow" Margin="{TemplateBinding Margin}" FontFamily="{DynamicResource SymbolFont}" Foreground="{TemplateBinding Foreground}" Text="&#xE76C;"/>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Foreground" Value="{DynamicResource Window.Active.Foreground}"/>
                                            </Trigger>
                                            <Trigger Property="IsChecked" Value="True">
                                                <Setter TargetName="Arrow" Property="Text" Value="&#xE70D;"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ControlTemplate.Resources>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto"/>
                            <ColumnDefinition Width="auto"/>
                            <ColumnDefinition Width="auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Border x:Name="ItemButton" 
                                      Grid.Column="0"
                                      Grid.ColumnSpan="3"
                                      CornerRadius="4"
                                      Margin="2"
                                      BorderBrush="{TemplateBinding BorderBrush}" 
                                      BorderThickness="{TemplateBinding BorderThickness}" 
                                      Background="{TemplateBinding Background}">
                                 
                        </Border>

                        <Border x:Name="SelectionBorder" Grid.Column="0" HorizontalAlignment="Left" Margin="5, 5, 3, 5" CornerRadius="1.5" Width="3" Visibility="Hidden" Background="{DynamicResource Item.SelectionHighlight.Border}"/>

                        <ToggleButton x:Name="NodeButton" 
                                      Grid.Column="1"   
                                      Margin="1"
                                      VerticalAlignment="Center"
                                      IsChecked="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=IsExpanded}"
                                      Style="{DynamicResource TreeViewNodeStyle}"
                                      Visibility="Hidden">
                        </ToggleButton>

                        <Label x:Name="PART_Header"
                               Grid.Column="2"
                               Padding="20, 2, 2, 2"
                               Content="{TemplateBinding Header}"
                               ContentTemplate="{TemplateBinding HeaderTemplate}"
                               ContentTemplateSelector="{TemplateBinding HeaderTemplateSelector}"
                               Foreground="{TemplateBinding Foreground}"
                               FontFamily="{TemplateBinding FontFamily}"
                               FontSize="{TemplateBinding FontSize}"
                               FontWeight="{TemplateBinding FontWeight}"
                               FontStretch="{TemplateBinding FontStretch}"
                               FontStyle="{TemplateBinding FontStyle}"
                               VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                               HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                               SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>    

                        <ItemsPresenter x:Name="ItemPresenter" Grid.Column="1" Grid.Row="1" Grid.ColumnSpan="3" Margin="20, 0, 0, 0" Visibility="Collapsed"/>
                    </Grid>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsExpanded" Value="True">
                            <Setter TargetName="ItemPresenter" Property="Visibility" Value="Visible"/>
                        </Trigger>
                        <Trigger Property="HasItems" Value="True">
                            <Setter TargetName="NodeButton" Property="Visibility" Value="Visible"/>
                        </Trigger>
                        <Trigger SourceName="ItemButton" Property="IsMouseOver" Value="True">
                            <Setter Property="Background"  TargetName="ItemButton" Value="{DynamicResource Item.MouseOver.Background}"/>
                            <Setter Property="BorderBrush" TargetName="ItemButton" Value="{DynamicResource Item.MouseOver.Border}"/>
                        </Trigger>
                        <Trigger Property="IsEnabled" Value="False">
                            <Setter Property="Foreground" Value="{DynamicResource Window.Active.Foreground.Disabled}"/>
                        </Trigger>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background"  TargetName="ItemButton" Value="{DynamicResource Item.Selected.Background}"/>
                            <Setter Property="BorderBrush" TargetName="ItemButton" Value="{DynamicResource Item.Selected.Border}"/>
                            <Setter Property="Visibility"  TargetName="SelectionBorder" Value="Visible"/>
                        </Trigger>
                        <!--<MultiTrigger>
                            <MultiTrigger.Conditions>
                                <Condition Property="IsSelected" Value="True"/>
                                <Condition Property="IsSelectionActive" Value="True"/>
                            </MultiTrigger.Conditions>
                            <Setter TargetName="ItemButton" Property="IsChecked" Value="True"/>
                        </MultiTrigger>-->
                        <!--<Trigger Property="IsSelected" Value="True">
                            <Setter TargetName="ItemButton" Property="IsChecked" Value="True"/>
                        </Trigger>
                        <Trigger Property="IsSelectionActive" Value="False">
                            <Setter TargetName="ItemButton" Property="IsChecked" Value="False"/>
                        </Trigger>-->
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>