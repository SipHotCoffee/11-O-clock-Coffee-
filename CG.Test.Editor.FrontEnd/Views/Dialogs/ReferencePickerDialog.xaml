<frontend:CustomWindow x:Class="CG.Test.Editor.FrontEnd.Views.Dialogs.ReferencePickerDialog"
					   xmlns:frontend="clr-namespace:CG.Test.Editor.FrontEnd"
					   xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
					   xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
					   xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
					   xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
					   xmlns:local="clr-namespace:CG.Test.Editor.FrontEnd.Views.Dialogs" 
					   xmlns:viewmodelnodes="clr-namespace:CG.Test.Editor.FrontEnd.ViewModels.Nodes" 
					   xmlns:converters="clr-namespace:CG.Test.Editor.FrontEnd.Converters"
					   mc:Ignorable="d"
					   Title="Select node to reference" 
					   Height="720" Width="1280"
					   WindowStartupLocation="CenterScreen"
					   DataContext="{Binding RelativeSource={RelativeSource Mode=Self}}">
	<Window.Resources>
		<converters:IsNotNullConverter x:Key="IsNotNullConverter"/>

		<local:NodeContainsMatchingType x:Key="NodeContainsMatchingType"/>
		<local:SelectedNodeHasMatchingType x:Key="SelectedNodeHasMatchingType"/>

		<local:NodeFromPairConverter x:Key="NodeFromPairConverter"/>
	</Window.Resources>
	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="*"/>
			<RowDefinition Height="auto"/>
		</Grid.RowDefinitions>
		
		<Grid>
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="0.3*"/>
				<ColumnDefinition Width="5"/>
				<ColumnDefinition Width="*"/>
			</Grid.ColumnDefinitions>

			<TreeView Grid.Column="0" Margin="5, 5, 2.5, 5" ItemsSource="{Binding Roots}" MinWidth="200" SelectedItemChanged="TreeView_SelectedItemChanged">
				<TreeView.ItemTemplate>
					<HierarchicalDataTemplate ItemsSource="{Binding Children}">
						<TextBlock Text="{Binding Name}"/>
					</HierarchicalDataTemplate>
				</TreeView.ItemTemplate>
			</TreeView>

			<GridSplitter Grid.Column="1" ResizeDirection="Columns" Width="5" HorizontalAlignment="Stretch"/>

			<Grid Grid.Column="2">
				<Grid.RowDefinitions>
					<RowDefinition Height="auto"/>
					<RowDefinition Height="*"/>
				</Grid.RowDefinitions>

				<ToolBar Grid.Row="0" Grid.ColumnSpan="2">
					<Button x:Name="_moveBackButton" Margin="5, 5, 2.5, 5" Content="&#xe72b;" FontFamily="{StaticResource SymbolFont}"
							IsEnabled="{Binding IsBackButtonEnabled}" Click="MoveBackButton_Click"/>

					<Button x:Name="_moveForwardButton" Margin="2.5, 5, 2.5, 5" Content="&#xe72a;" FontFamily="{StaticResource SymbolFont}" 
							IsEnabled="{Binding IsForwardButtonEnabled}" Click="MoveForwardButton_Click"/>

					<Separator/>

					<Button x:Name="_moveUpButton" Margin="2.5, 5, 2.5, 5" Content="&#xe74a;" FontFamily="{StaticResource SymbolFont}" Click="MoveUpButton_Click" 
							IsEnabled="{Binding CurrentNode.Parent, Converter={StaticResource IsNotNullConverter}}"/>

					<Separator/>

					<ItemsControl ItemsSource="{Binding AddressItems}">
						<ItemsControl.ItemsPanel>
							<ItemsPanelTemplate>
								<StackPanel Orientation="Horizontal"/>
							</ItemsPanelTemplate>
						</ItemsControl.ItemsPanel>
						<ItemsControl.ItemTemplate>
							<DataTemplate>
								<Button x:Name="_addressItemButton" Content="{Binding Name}" Margin="2.5, 5, 2.5, 5" Tag="{Binding}" Click="AddressItemButton_Click"/>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
				</ToolBar>

				<ContentControl Grid.Row="1" Content="{Binding CurrentNode}" Grid.ColumnSpan="2">
					<ContentControl.Resources>
						<DataTemplate DataType="{x:Type viewmodelnodes:ArrayNodeViewModel}">
							<Grid>
								<Grid.RowDefinitions>
									<RowDefinition Height="auto"/>
									<RowDefinition Height="*"/>
								</Grid.RowDefinitions>
								<ScrollViewer Grid.Row="1">
									<Grid>
										<Grid.ColumnDefinitions>
											<ColumnDefinition Width="auto"/>
											<ColumnDefinition Width="*"/>
										</Grid.ColumnDefinitions>

										<ListView Grid.Column="0" Margin="2.5, 5, 5, 5" IsEnabled="False" 
												  ItemsSource="{Binding Indices}" 
												  Background="Transparent" 
												  BorderBrush="Transparent">
											<ListView.ItemTemplate>
												<DataTemplate>
													<Grid>
														<Grid.ColumnDefinitions>
															<ColumnDefinition Width="auto"/>
															<ColumnDefinition Width="auto"/>
															<ColumnDefinition Width="auto"/>
														</Grid.ColumnDefinitions>
														<TextBlock FontFamily="Cascadia Mono" Grid.Column="0" VerticalAlignment="Center" Text="["/>
														<TextBlock FontFamily="Cascadia Mono" Grid.Column="1" VerticalAlignment="Center" Text="{Binding}"/>
														<TextBlock FontFamily="Cascadia Mono" Grid.Column="2" VerticalAlignment="Center" Text="]: "/>
													</Grid>
												</DataTemplate>
											</ListView.ItemTemplate>
										</ListView>
										<ListView x:Name="_listView" Grid.Column="1" Margin="2.5, 5, 5, 5" SelectionMode="Single"
												  Resources="{StaticResource NodeCompactDataTemplates}" ItemsSource="{Binding Elements}" 
												  SelectedItem="{Binding Mode=TwoWay, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type local:ReferencePickerDialog}}, Path=SelectedNode}">
											<ListView.ItemContainerStyle>
												<Style TargetType="{x:Type ListViewItem}" BasedOn="{StaticResource {x:Type ListViewItem}}">
													<Setter Property="IsEnabled">
														<Setter.Value>
															<MultiBinding Converter="{StaticResource NodeContainsMatchingType}">
																<MultiBinding.Bindings>
																	<Binding Mode="OneWay" Path="."/>
																	<Binding Mode="OneWay" 
																			 RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType={x:Type local:ReferencePickerDialog}}"
																			 Path="FilterType"/>
																</MultiBinding.Bindings>
															</MultiBinding>
														</Setter.Value>
													</Setter>
													<Setter Property="VerticalContentAlignment" Value="Center"/>
													<Setter Property="VerticalAlignment" Value="Center"/>
													<EventSetter Event="MouseDoubleClick" Handler="ArrayViewItem_MouseDoubleClick"/>
												</Style>
											</ListView.ItemContainerStyle>
										</ListView>
									</Grid>
								</ScrollViewer>
							</Grid>
						</DataTemplate>
						<DataTemplate DataType="{x:Type viewmodelnodes:ObjectNodeViewModel}">
							<ListView ItemsSource="{Binding Nodes}" SelectionMode="Single" 
									  SelectedItem="{Binding Converter={StaticResource NodeFromPairConverter}, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type local:ReferencePickerDialog}}, Path=SelectedNode}">
								<ListView.ItemContainerStyle>
									<Style TargetType="{x:Type ListViewItem}" BasedOn="{StaticResource {x:Static GridView.GridViewItemContainerStyleKey}}">
										<Setter Property="IsEnabled">
											<Setter.Value>
												<MultiBinding Converter="{StaticResource NodeContainsMatchingType}">
													<MultiBinding.Bindings>
														<Binding Mode="OneWay" Path="Value"/>
														<Binding Mode="OneWay" 
																 RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType={x:Type local:ReferencePickerDialog}}"
																 Path="FilterType"/>
													</MultiBinding.Bindings>
												</MultiBinding>
											</Setter.Value>
										</Setter>
										<Setter Property="VerticalContentAlignment" Value="Center"/>
										<Setter Property="VerticalAlignment" Value="Center"/>
										<EventSetter Event="MouseDoubleClick" Handler="ObjectViewItem_MouseDoubleClick"/>
									</Style>
								</ListView.ItemContainerStyle>
								<ListView.View>
									<GridView>
										<GridView.Columns>
											<GridViewColumn Header="Property Name">
												<GridViewColumn.CellTemplate>
													<DataTemplate>
														<StackPanel Orientation="Horizontal" VerticalAlignment="Center">
															<TextBlock VerticalAlignment="Center" FontFamily="Cascadia Mono" 
																				   FontWeight="Bold" FontSize="16" Text="{Binding Key}"/>
															<TextBlock VerticalAlignment="Center" FontFamily="Cascadia Mono" 
																				   FontWeight="Bold" FontSize="16" Text=": "/>
														</StackPanel>
													</DataTemplate>
												</GridViewColumn.CellTemplate>
											</GridViewColumn>
											<GridViewColumn Header="Value">
												<GridViewColumn.CellTemplate>
													<DataTemplate>
														<ContentControl VerticalAlignment="Center" 
																		Content="{Binding Value}"
																		Resources="{StaticResource NodeCompactDataTemplates}"/>
													</DataTemplate>
												</GridViewColumn.CellTemplate>
											</GridViewColumn>
										</GridView.Columns>
									</GridView>
								</ListView.View>
							</ListView>
						</DataTemplate>
					</ContentControl.Resources>
				</ContentControl>
			</Grid>
		</Grid>

		<Grid Grid.Row="1" HorizontalAlignment="Right" Width="350" Margin="5, 2.5, 5, 5">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="*"/>
				<ColumnDefinition Width="*"/>
			</Grid.ColumnDefinitions>

			<Button Grid.Column="0" Margin="0, 0, 5, 0"     Content="None" IsCancel="True"/>
			<Button Grid.Column="1" Margin="2.5, 0, 2.5, 0" Content="Selected" IsDefault="True" Click="SelectedButton_Click">
				<Button.IsEnabled>
					<MultiBinding Converter="{StaticResource SelectedNodeHasMatchingType}">
						<MultiBinding.Bindings>
							<Binding Mode="OneWay" Path="SelectedNode"/>
							<Binding Mode="OneWay" Path="FilterType"/>
						</MultiBinding.Bindings>
					</MultiBinding>
				</Button.IsEnabled>
			</Button>
		</Grid>
	</Grid>
</frontend:CustomWindow>
