<local:CustomWindow x:Class="CG.Test.Editor.FrontEnd.Views.MainWindow"
					xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
					xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
					xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
					xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
					xmlns:local="clr-namespace:CG.Test.Editor.FrontEnd"
					xmlns:viewmodels="clr-namespace:CG.Test.Editor.FrontEnd.ViewModels"
					xmlns:converters="clr-namespace:CG.Test.Editor.FrontEnd.Converters"
					mc:Ignorable="d"
					Title="Json Editor" Height="450" Width="800" IsMicaBackgroundEnabled="True" WindowStartupLocation="CenterScreen" WindowState="Maximized">
	<Window.DataContext>
		<viewmodels:MainViewModel/>
	</Window.DataContext>
	<Window.Resources>
		<ResourceDictionary>
			<converters:IsNotNullConverter x:Key="IsNotNullConverter"/>

			<ResourceDictionary x:Key="NodeVeryCompactDataTemplates">
				<DataTemplate DataType="{x:Type viewmodels:ArrayNodeViewModel}">
					<TextBlock Text="[...]"/>
				</DataTemplate>
				<DataTemplate DataType="{x:Type viewmodels:ObjectNodeViewModel}">
					<StackPanel Orientation="Horizontal">
						<TextBlock Text="{Binding Type.Name}"/>
						<TextBlock Text="{} {...}"/>
					</StackPanel>
				</DataTemplate>
				<DataTemplate DataType="{x:Type viewmodels:IntegerNodeViewModel}">
					<TextBlock Text="{Binding Value}"/>
				</DataTemplate>
				<DataTemplate DataType="{x:Type viewmodels:NumberNodeViewModel}">
					<TextBlock Text="{Binding Value}"/>
				</DataTemplate>
				<DataTemplate DataType="{x:Type viewmodels:BooleanNodeViewModel}">
					<TextBlock Text="{Binding Value}"/>
				</DataTemplate>
				<DataTemplate DataType="{x:Type viewmodels:StringNodeViewModel}">
					<StackPanel Orientation="Horizontal">
						<TextBlock Text="&quot;"/>
						<TextBlock Text="{Binding Value}"/>
						<TextBlock Text="&quot;"/>
					</StackPanel>
				</DataTemplate>
			</ResourceDictionary>

			<ResourceDictionary x:Key="NodeCompactDataTemplates">
				<DataTemplate DataType="{x:Type viewmodels:ArrayNodeViewModel}">
					<StackPanel Orientation="Horizontal" VerticalAlignment="Center">
						<TextBlock Text="{Binding Type.ElementType.Name}"/>
						<TextBlock Text="["/>
						<TextBlock Text="{Binding Elements.Count}"/>
						<TextBlock Text="]"/>
						<TextBlock Text="{} { "/>

						<ItemsControl Resources="{StaticResource NodeVeryCompactDataTemplates}" ItemsSource="{Binding Elements}">
							<ItemsControl.ItemsPanel>
								<ItemsPanelTemplate>
									<StackPanel Orientation="Horizontal"/>
								</ItemsPanelTemplate>
							</ItemsControl.ItemsPanel>
							<ItemsControl.ItemTemplate>
								<DataTemplate>
									<StackPanel Orientation="Horizontal">
										<TextBlock x:Name="commaTextBlock" Text=", "/>
										<ContentPresenter Content="{Binding}"/>
									</StackPanel>
									<DataTemplate.Triggers>
										<DataTrigger Binding="{Binding RelativeSource={RelativeSource PreviousData}}" Value="{x:Null}">
											<Setter Property="Visibility" TargetName="commaTextBlock" Value="Collapsed"/>
										</DataTrigger>
									</DataTemplate.Triggers>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>
						<TextBlock Text="{} }"/>
					</StackPanel>
				</DataTemplate>
				<DataTemplate DataType="{x:Type viewmodels:ObjectNodeViewModel}">
					<StackPanel Orientation="Horizontal" VerticalAlignment="Center">
						<TextBlock Text="{Binding Type.Name}"/>
						<TextBlock Text="{} { "/>
						<ItemsControl Resources="{StaticResource NodeVeryCompactDataTemplates}" ItemsSource="{Binding Nodes}">
							<ItemsControl.ItemsPanel>
								<ItemsPanelTemplate>
									<StackPanel Orientation="Horizontal"/>
								</ItemsPanelTemplate>
							</ItemsControl.ItemsPanel>
							<ItemsControl.ItemTemplate>
								<DataTemplate>
									<StackPanel Orientation="Horizontal">
										<TextBlock x:Name="commaTextBlock" Text=", "/>
										<ContentPresenter Content="{Binding Value}"/>
									</StackPanel>
									<DataTemplate.Triggers>
										<DataTrigger Binding="{Binding RelativeSource={RelativeSource PreviousData}}" Value="{x:Null}">
											<Setter Property="Visibility" TargetName="commaTextBlock" Value="Collapsed"/>
										</DataTrigger>
									</DataTemplate.Triggers>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>
						<TextBlock Text="{} }"/>
					</StackPanel>
				</DataTemplate>
				<DataTemplate DataType="{x:Type viewmodels:IntegerNodeViewModel}">
					<TextBlock Text="{Binding Value}"/>
				</DataTemplate>
				<DataTemplate DataType="{x:Type viewmodels:NumberNodeViewModel}">
					<TextBlock Text="{Binding Value}"/>
				</DataTemplate>
				<DataTemplate DataType="{x:Type viewmodels:BooleanNodeViewModel}">
					<TextBlock Text="{Binding Value}"/>
				</DataTemplate>
				<DataTemplate DataType="{x:Type viewmodels:StringNodeViewModel}">
					<StackPanel Orientation="Horizontal">
						<TextBlock Text="&quot;"/>
						<TextBlock Text="{Binding Value}"/>
						<TextBlock Text="&quot;"/>
					</StackPanel>
				</DataTemplate>
			</ResourceDictionary>
		</ResourceDictionary>
	</Window.Resources>
    <Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>
		<Menu Grid.Row="0">
			<MenuItem Header="File">
				<MenuItem Header="New"     InputGestureText="Ctrl+N" Command="{Binding NewFileCommand}"/>
				<MenuItem Header="Open..." InputGestureText="Ctrl+O"/>
				<MenuItem Header="Save"    InputGestureText="Ctrl+S"/>
				<MenuItem Header="Save As..."/>
				<Separator/>
				<MenuItem Header="Exit" InputGestureText="Alt+F4" Command="{Binding ExitCommand}"
						  CommandParameter="{Binding RelativeSource={RelativeSource AncestorType={x:Type Window}}}"/>
			</MenuItem>
		</Menu>
		<TabControl Grid.Row="1" ItemsSource="{Binding OpenFiles}">
			<TabControl.ItemTemplate>
				<DataTemplate>
					<Grid VerticalAlignment="Center" HorizontalAlignment="Stretch">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="auto"/>
							<ColumnDefinition Width="auto"/>
						</Grid.ColumnDefinitions>
						<TextBlock Grid.Column="0" Text="{Binding Name}" VerticalAlignment="Center"/>
						<TextBlock Grid.Column="1" Text="*" Visibility="Collapsed" VerticalAlignment="Center"/>
						<Button    Grid.Column="2" Margin="5, 0, 5, 0" FontSize="12" FontFamily="{StaticResource SymbolFont}" Content="&#xE8BB;" VerticalAlignment="Center"/>
					</Grid>
				</DataTemplate>
			</TabControl.ItemTemplate>
			<TabControl.ContentTemplate>
				<DataTemplate>
					<Grid>
						<Grid.RowDefinitions>
							<RowDefinition Height="auto"/>
							<RowDefinition Height="*"/>
						</Grid.RowDefinitions>
						<ToolBar Grid.Row="0">
							<Button Margin="5, 5, 2.5, 5"   Content="&#xe72b;" FontFamily="{StaticResource SymbolFont}"
									IsEnabled="{Binding IsBackButtonEnabled}" Command="{Binding MoveBackCommand}"/>
							<Button Margin="2.5, 5, 2.5, 5" Content="&#xe72a;" FontFamily="{StaticResource SymbolFont}" 
									IsEnabled="{Binding IsForwardButtonEnabled}" Command="{Binding MoveForwardCommand}"/>
							<Separator/>
							<Button Margin="2.5, 5, 5, 5" Content="&#xe74a;" FontFamily="{StaticResource SymbolFont}" Command="{Binding MoveUpCommand}" 
									IsEnabled="{Binding Current.Parent, Converter={StaticResource IsNotNullConverter}}"/>
							<Separator/>

							<ItemsControl ItemsSource="{Binding AddressItems}">
								<ItemsControl.ItemsPanel>
									<ItemsPanelTemplate>
										<StackPanel Orientation="Horizontal"/>
									</ItemsPanelTemplate>
								</ItemsControl.ItemsPanel>
								<ItemsControl.ItemTemplate>
									<DataTemplate>
										<Button Content="{Binding Node.Name}" Margin="2.5, 5, 2.5, 5" 
												Command="{Binding  Path=NavigateCommand}" 
												CommandParameter="{Binding Node}"/>
									</DataTemplate>
								</ItemsControl.ItemTemplate>
							</ItemsControl>
						</ToolBar>
						<ContentControl Grid.Row="1" Content="{Binding Current}">
							<ContentControl.Resources>
								<DataTemplate DataType="{x:Type viewmodels:ArrayNodeViewModel}">
									<Grid>
										<Grid.RowDefinitions>
											<RowDefinition Height="auto"/>
											<RowDefinition Height="*"/>
										</Grid.RowDefinitions>
										<ToolBar>
											<Button FontFamily="{StaticResource SymbolFont}" FontSize="18" Content="&#xe948;" Command="{Binding InsertCommand}"/>
											
											<Button x:Name="CUT"    FontFamily="{StaticResource SymbolFont}" FontSize="18" Content="&#xe8c6;"/>
											<Button x:Name="COPY"   FontFamily="{StaticResource SymbolFont}" FontSize="18" Content="&#xe8c8;"/>
											<Button x:Name="PASTE"  FontFamily="{StaticResource SymbolFont}" FontSize="18" Content="&#xe77f;"/>
											<Button x:Name="DELETE" FontFamily="{StaticResource SymbolFont}" FontSize="18" Content="&#xe74d;"/>
										</ToolBar>
										<ScrollViewer Grid.Row="1">
											<Grid>
												<Grid.ColumnDefinitions>
													<ColumnDefinition Width="auto"/>
													<ColumnDefinition Width="*"/>
												</Grid.ColumnDefinitions>

												<ListView Grid.Column="0" Margin="5" IsEnabled="False" 
														  ItemsSource="{Binding Indices}" Background="Transparent" BorderBrush="Transparent">
													<ListView.ItemTemplate>
														<DataTemplate>
															<Grid>
																<Grid.ColumnDefinitions>
																	<ColumnDefinition Width="auto"/>
																	<ColumnDefinition Width="auto"/>
																	<ColumnDefinition Width="auto"/>
																</Grid.ColumnDefinitions>
																<TextBlock Grid.Column="0" VerticalAlignment="Center" Text="["/>
																<TextBlock Grid.Column="1" VerticalAlignment="Center" Text="{Binding}"/>
																<TextBlock Grid.Column="2" VerticalAlignment="Center" Text="]: "/>
															</Grid>
														</DataTemplate>
													</ListView.ItemTemplate>
												</ListView>
												<ListView Grid.Column="1" Margin="5" ItemsSource="{Binding Elements}" Resources="{StaticResource NodeCompactDataTemplates}">
													<ListView.ItemContainerStyle>
														<Style TargetType="{x:Type ListViewItem}" BasedOn="{StaticResource {x:Type ListViewItem}}">
															<Setter Property="VerticalContentAlignment" Value="Center"/>
															<Setter Property="VerticalAlignment" Value="Center"/>
															<EventSetter Event="MouseDoubleClick" Handler="ArrayViewItem_MouseDoubleClick"/>
														</Style>
													</ListView.ItemContainerStyle>
												</ListView>
											</Grid>
										</ScrollViewer>
									</Grid>
								</DataTemplate>
								<DataTemplate DataType="{x:Type viewmodels:ObjectNodeViewModel}">
									<ListView ItemsSource="{Binding Nodes}">
										<ListView.ItemContainerStyle>
											<Style TargetType="{x:Type ListViewItem}" BasedOn="{StaticResource {x:Static GridView.GridViewItemContainerStyleKey}}">
												<Setter Property="VerticalContentAlignment" Value="Center"/>
												<Setter Property="VerticalAlignment" Value="Center"/>
												<EventSetter Event="MouseDoubleClick" Handler="ObjectViewItem_MouseDoubleClick"/>
											</Style>
										</ListView.ItemContainerStyle>
										<ListView.View>
											<GridView>
												<GridView.Columns>
													<GridViewColumn Header="Property Name">
														<GridViewColumn.CellTemplate>
															<DataTemplate>
																<StackPanel Orientation="Horizontal" VerticalAlignment="Center">
																	<TextBlock VerticalAlignment="Center" FontFamily="Cascadia Mono" 
																			   FontWeight="Bold" FontSize="18" Text="{Binding Key}"/>
																	<TextBlock VerticalAlignment="Center" FontFamily="Cascadia Mono" 
																			   FontWeight="Bold" FontSize="18" Text=": "/>
																</StackPanel>
															</DataTemplate>
														</GridViewColumn.CellTemplate>
													</GridViewColumn>
													<GridViewColumn Header="Value">
														<GridViewColumn.CellTemplate>
															<DataTemplate>
																<ContentControl VerticalAlignment="Center" Content="{Binding Value}" 
																				Resources="{StaticResource NodeCompactDataTemplates}"/>
															</DataTemplate>
														</GridViewColumn.CellTemplate>
													</GridViewColumn>
												</GridView.Columns>
											</GridView>
										</ListView.View>	
									</ListView>
								</DataTemplate>
							</ContentControl.Resources>
						</ContentControl>
					</Grid>
				</DataTemplate>
			</TabControl.ContentTemplate>
		</TabControl>
    </Grid>
</local:CustomWindow>
