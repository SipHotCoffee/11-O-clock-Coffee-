<local:CustomWindow x:Class="CG.Test.Editor.FrontEnd.Views.MainWindow"
					xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
					xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
					xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
					xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
					xmlns:local="clr-namespace:CG.Test.Editor.FrontEnd"
					xmlns:viewmodels="clr-namespace:CG.Test.Editor.FrontEnd.ViewModels"
					xmlns:viewmodelnodes="clr-namespace:CG.Test.Editor.FrontEnd.ViewModels.Nodes"
					xmlns:converters="clr-namespace:CG.Test.Editor.FrontEnd.Converters"
					mc:Ignorable="d"
					Title="Json Editor" 
					Height="450" 
					Width="800" 
					IsMicaBackgroundEnabled="True" 
					WindowStartupLocation="CenterScreen" 
					WindowState="Maximized" 
					Closing="Window_Closing" d:DataContext="{d:DesignInstance Type={x:Type viewmodels:MainViewModel}}" Loaded="Window_Loaded">
	<Window.Resources>
		<converters:IsNotNullConverter x:Key="IsNotNullConverter"/>
		<BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
	</Window.Resources>
	<Window.InputBindings>
		<KeyBinding Modifiers="Ctrl" Key="N" Command="{Binding  NewFileCommand}" CommandParameter="{Binding RelativeSource={RelativeSource AncestorType={x:Type Window}}}"/>
		<KeyBinding Modifiers="Ctrl" Key="O" Command="{Binding OpenFileCommand}" CommandParameter="{Binding RelativeSource={RelativeSource AncestorType={x:Type Window}}}"/>
		<KeyBinding Modifiers="Ctrl" Key="S" Command="{Binding SaveFileCommand}"/>
	</Window.InputBindings>
    <Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>
		<Menu Grid.Row="0">
			<MenuItem Header="File">
				<MenuItem Header="New" InputGestureText="Ctrl+N" Command="{Binding NewFileCommand}" 
						  CommandParameter="{Binding RelativeSource={RelativeSource AncestorType={x:Type Window}}}"/>
				
				<MenuItem Header="Open..." InputGestureText="Ctrl+O" Command="{Binding OpenFileCommand}"
						  CommandParameter="{Binding RelativeSource={RelativeSource AncestorType={x:Type Window}}}"/>
				
				<MenuItem Header="Save" InputGestureText="Ctrl+S" Command="{Binding SaveFileCommand}">
					<MenuItem.Style>
						<Style TargetType="{x:Type MenuItem}" BasedOn="{StaticResource {x:Type MenuItem}}">
							<Style.Triggers>
								<DataTrigger Binding="{Binding OpenFiles.Count}" Value="0">
									<Setter Property="IsEnabled" Value="False"/>
								</DataTrigger>
								<DataTrigger Binding="{Binding SelectedFile.HasChanges}" Value="False">
									<Setter Property="IsEnabled" Value="False"/>
								</DataTrigger>
							</Style.Triggers>
						</Style>
					</MenuItem.Style>
				</MenuItem>
				<MenuItem Header="Save As..." Command="{Binding SaveFileAsCommand}">
					<MenuItem.Style>
						<Style TargetType="{x:Type MenuItem}" BasedOn="{StaticResource {x:Type MenuItem}}">
							<Style.Triggers>
								<DataTrigger Binding="{Binding OpenFiles.Count}" Value="0">
									<Setter Property="IsEnabled" Value="False"/>
								</DataTrigger>
							</Style.Triggers>
						</Style>
					</MenuItem.Style>
				</MenuItem>
				<Separator/>
				<MenuItem Header="Exit" InputGestureText="Alt+F4" Command="{Binding ExitCommand}"
						  CommandParameter="{Binding RelativeSource={RelativeSource AncestorType={x:Type Window}}}"/>
			</MenuItem>
		</Menu>
		<TabControl Grid.Row="1" ItemsSource="{Binding OpenFiles}" SelectedItem="{Binding SelectedFile}">
			<TabControl.ItemTemplate>
				<DataTemplate>
					<Grid VerticalAlignment="Center" HorizontalAlignment="Stretch">
						<Grid.ContextMenu>
							<ContextMenu>
								<MenuItem Header="Save" Command="{Binding SaveCommand}" IsEnabled="{Binding HasChanges}"/>
								<MenuItem Header="Save As" Command="{Binding SaveAsCommand}"/>
								<Separator/>
								<MenuItem Header="Open in File Explorer"
										  Command="{Binding OpenInExplorerCommand}" 
										  IsEnabled="{Binding File, Mode=OneWay, Converter={StaticResource IsNotNullConverter}}"/>
							</ContextMenu>
						</Grid.ContextMenu>
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="auto"/>
							<ColumnDefinition Width="auto"/>
						</Grid.ColumnDefinitions>
						<TextBlock Grid.Column="0" TextAlignment="Center" Text="{Binding Name}" VerticalAlignment="Center"/>
						<TextBlock Grid.Column="1" Text="*" Margin="2.5, 0, 2.5, 0" 
								   Visibility="{Binding HasChanges, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}"
								   VerticalAlignment="Center"/>
						
						<Button Grid.Column="2" Margin="2.5, 0, 0, 0" Padding="6" FontSize="10" FontFamily="{StaticResource SymbolFont}" 
								Content="&#xE8BB;" VerticalAlignment="Center" Command="{Binding CloseCommand}" Style="{StaticResource {x:Static ToolBar.ButtonStyleKey}}"/>
					</Grid>
				</DataTemplate>
			</TabControl.ItemTemplate>
			<TabControl.ContentTemplate>
				<DataTemplate>
					<Grid>
						<Grid.RowDefinitions>
							<RowDefinition Height="auto"/>
							<RowDefinition Height="*"/>
						</Grid.RowDefinitions>
						<ToolBar Grid.Row="0">
							<Button Margin="5, 5, 2.5, 5"   Content="&#xe72b;" FontFamily="{StaticResource SymbolFont}"
									IsEnabled="{Binding IsBackButtonEnabled}" Command="{Binding MoveBackCommand}"/>
							<Button Margin="2.5, 5, 2.5, 5" Content="&#xe72a;" FontFamily="{StaticResource SymbolFont}" 
									IsEnabled="{Binding IsForwardButtonEnabled}" Command="{Binding MoveForwardCommand}"/>
							<Separator/>
							<Button Margin="2.5, 5, 2.5, 5" Content="&#xe74a;" FontFamily="{StaticResource SymbolFont}" Command="{Binding MoveUpCommand}" 
									IsEnabled="{Binding Current.Parent, Converter={StaticResource IsNotNullConverter}}"/>
							<Separator/>

							<Button Margin="2.5, 5, 5, 5" Content="&#xe90f;" FontFamily="{StaticResource SymbolFont}" Command="{Binding RepairCommand}"/>
							
							<Separator/>
							
							<ItemsControl ItemsSource="{Binding AddressItems}">
								<ItemsControl.ItemsPanel>
									<ItemsPanelTemplate>
										<StackPanel Orientation="Horizontal"/>
									</ItemsPanelTemplate>
								</ItemsControl.ItemsPanel>
								<ItemsControl.ItemTemplate>
									<DataTemplate>
										<Button Content="{Binding Name}" Margin="2.5, 5, 2.5, 5" 
												Command="{Binding Path=NavigateCommand}" 
												CommandParameter="{Binding Node}"/>
									</DataTemplate>
								</ItemsControl.ItemTemplate>
							</ItemsControl>
						</ToolBar>
						<ContentControl Grid.Row="1" Content="{Binding Current}">
							<ContentControl.Resources>
								<viewmodelnodes:IsInsertEnabledConverter x:Key="IsInsertEnabledConverter"/>
								<viewmodelnodes:IsDeleteEnabledConverter x:Key="IsDeleteEnabledConverter"/>
								<viewmodelnodes:IsPasteEnabledConverter  x:Key="IsPasteEnabledConverter"/>

								<DataTemplate DataType="{x:Type viewmodelnodes:ArrayNodeViewModel}">
									<Grid>
										<Grid.RowDefinitions>
											<RowDefinition Height="auto"/>
											<RowDefinition Height="*"/>
										</Grid.RowDefinitions>
										<ToolBar>
											<ToolBar.Resources>
												<Style x:Key="MultipleSelectionButton" 
													   TargetType="{x:Type Button}" BasedOn="{StaticResource {x:Static ToolBar.ButtonStyleKey}}">
													<Style.Triggers>
														<DataTrigger Binding="{Binding ElementName=_listView, Path=SelectedItems.Count}" Value="0">
															<Setter Property="IsEnabled" Value="False"/>
														</DataTrigger>
													</Style.Triggers>
												</Style>

												<Style x:Key="DeleteMultipleSelectionButton" 
													   TargetType="{x:Type Button}" BasedOn="{StaticResource {x:Static ToolBar.ButtonStyleKey}}">
													<Setter Property="IsEnabled" Value="False"/>
													<Style.Triggers>
														<DataTrigger Value="True">
															<DataTrigger.Binding>
																<MultiBinding Converter="{StaticResource IsDeleteEnabledConverter}">
																	<Binding Path="Elements.Count"/>
																	<Binding Path="Type"/>
																	<Binding ElementName="_listView" Path="SelectedItems.Count"/>
																</MultiBinding>
															</DataTrigger.Binding>
															<Setter Property="IsEnabled" Value="True"/>
														</DataTrigger>
													</Style.Triggers>
												</Style>

												<Style x:Key="ClipboardHasItemsButton" 
													   TargetType="{x:Type Button}" BasedOn="{StaticResource {x:Static ToolBar.ButtonStyleKey}}">
													<Setter Property="IsEnabled" Value="False"/>
													<Style.Triggers>
														<DataTrigger Binding="{Binding Path=Editor.HasClipboardNodes}" Value="True">
															<Setter Property="IsEnabled" Value="True"/>
														</DataTrigger>
													</Style.Triggers>
												</Style>

												<Style x:Key="ClipboardItemCountInRange" 
													   TargetType="{x:Type Button}" BasedOn="{StaticResource {x:Static ToolBar.ButtonStyleKey}}">
													<Setter Property="IsEnabled" Value="False"/>
													<Style.Triggers>
														<DataTrigger Value="True">
															<DataTrigger.Binding>
																<MultiBinding Converter="{StaticResource IsPasteEnabledConverter}">
																	<MultiBinding.Bindings>
																		<Binding Path="Elements.Count"/>
																		<Binding Path="Type"/>
																		<Binding Path="Editor.ClipboardNodes.Count"/>
																	</MultiBinding.Bindings>
																</MultiBinding>
															</DataTrigger.Binding>
															<Setter Property="IsEnabled" Value="True"/>
														</DataTrigger>
													</Style.Triggers>
												</Style>

												<Style x:Key="SingleSelectionButton" 
													   TargetType="{x:Type Button}" 
													   BasedOn="{StaticResource {x:Static ToolBar.ButtonStyleKey}}">
													<Setter Property="IsEnabled" Value="False"/>
													<Style.Triggers>
														<DataTrigger Binding="{Binding ElementName=_listView, Path=SelectedItems.Count}" Value="1">
															<Setter Property="IsEnabled" Value="True"/>
														</DataTrigger>
													</Style.Triggers>
												</Style>

												<Style x:Key="SingleInsertSelectionButton" 
													   TargetType="{x:Type Button}" 
													   BasedOn="{StaticResource {x:Static ToolBar.ButtonStyleKey}}">
													<Setter Property="IsEnabled" Value="False"/>
													<Style.Triggers>
														<MultiDataTrigger>
															<MultiDataTrigger.Conditions>
																<Condition Binding="{Binding ElementName=_listView, Path=SelectedItems.Count}" Value="1"/>
																<Condition Value="True">
																	<Condition.Binding>
																		<MultiBinding Converter="{StaticResource IsInsertEnabledConverter}">
																			<Binding Path="Elements.Count"/>
																			<Binding Path="Type"/>
																		</MultiBinding>
																	</Condition.Binding>
																</Condition>
															</MultiDataTrigger.Conditions>
															<Setter Property="IsEnabled" Value="True"/>
														</MultiDataTrigger>
													</Style.Triggers>
												</Style>

												<Style x:Key="PasteSingleSelectionButton" 
													   TargetType="{x:Type Button}" BasedOn="{StaticResource {x:Static ToolBar.ButtonStyleKey}}">
													<Setter Property="IsEnabled" Value="False"/>
													<Style.Triggers>
														<MultiDataTrigger>
															<MultiDataTrigger.Conditions>
																<Condition Binding="{Binding ElementName=_listView, Path=SelectedItems.Count}" Value="1"/>
																<Condition Binding="{Binding Path=Editor.HasClipboardNodes}" Value="True"/>
															</MultiDataTrigger.Conditions>
															<Setter Property="IsEnabled" Value="True"/>
														</MultiDataTrigger>
													</Style.Triggers>
												</Style>
											</ToolBar.Resources>

											<Button Command="{Binding InsertCommand}">
												<Button.IsEnabled>
													<MultiBinding Converter="{StaticResource IsInsertEnabledConverter}">
														<Binding Path="Elements.Count"/>
														<Binding Path="Type"/>
													</MultiBinding>
												</Button.IsEnabled>
												<Button.Content>
													<StackPanel Orientation="Horizontal" Margin="0">
														<TextBlock FontSize="18" FontFamily="{StaticResource SymbolFont}" Text="&#xe948;"/>
														<TextBlock Text=" *"
																   Visibility="{Binding Editor.MainViewModel.IsAltDown, Converter={StaticResource BooleanToVisibilityConverter}}"/>
													</StackPanel>
												</Button.Content>
											</Button>

											<Button Command="{Binding InsertAboveCommand}" 
													CommandParameter="{Binding ElementName=_listView, Path=SelectedIndex}"
													Style="{StaticResource SingleInsertSelectionButton}">
												<StackPanel Orientation="Vertical" HorizontalAlignment="Center">
													<TextBlock HorizontalAlignment="Center" FontFamily="{StaticResource SymbolFont}" FontSize="12" Margin="2" Text="&#xe74a;"/>
													<TextBlock HorizontalAlignment="Center" FontFamily="{StaticResource SymbolFont}" FontSize="18" Margin="2" Text="&#xe948;"/>
												</StackPanel>
											</Button>

											<Button Command="{Binding InsertBelowCommand}" 
													CommandParameter="{Binding ElementName=_listView, Path=SelectedIndex}"
													Style="{StaticResource SingleInsertSelectionButton}">
												<StackPanel Orientation="Vertical" HorizontalAlignment="Center">
													<TextBlock HorizontalAlignment="Center" FontFamily="{StaticResource SymbolFont}" FontSize="18" Margin="2" Text="&#xe948;"/>
													<TextBlock HorizontalAlignment="Center" FontFamily="{StaticResource SymbolFont}" FontSize="12" Margin="2" Text="&#xe74b;"/>
												</StackPanel>
											</Button>

											<Button FontFamily="{StaticResource SymbolFont}" 
													FontSize="18" 
													Content="&#xe8c6;"
													Command="{Binding CutElementsCommand}"
													CommandParameter="{Binding ElementName=_listView, Path=SelectedItems}"
													Style="{StaticResource DeleteMultipleSelectionButton}">
											</Button>
											
											<Button FontFamily="{StaticResource SymbolFont}" 
													FontSize="18" 
													Content="&#xe8c8;"
													Command="{Binding CopyElementsCommand}"
													CommandParameter="{Binding ElementName=_listView, Path=SelectedItems}"
													Style="{StaticResource MultipleSelectionButton}"/>

											<Button FontSize="18"
													Command="{Binding PasteElementsCommand}"
													Style="{StaticResource ClipboardItemCountInRange}">
												<Button.Content>
													<StackPanel Orientation="Horizontal">
														<TextBlock FontFamily="{StaticResource SymbolFont}" Text="&#xe77f;"/>
														<TextBlock Text=" *" 
																   Visibility="{Binding Editor.MainViewModel.IsAltDown, Converter={StaticResource BooleanToVisibilityConverter}}"/>
													</StackPanel>
												</Button.Content>
											</Button>

											<Button Command="{Binding PasteAboveElementsCommand}" 
													CommandParameter="{Binding ElementName=_listView, Path=SelectedIndex}"
													Style="{StaticResource ClipboardItemCountInRange}">
												<StackPanel Orientation="Vertical" HorizontalAlignment="Center">
													<TextBlock HorizontalAlignment="Center" FontFamily="{StaticResource SymbolFont}" FontSize="12" Margin="2" Text="&#xe74a;"/>
													<TextBlock HorizontalAlignment="Center" FontFamily="{StaticResource SymbolFont}" FontSize="18" Margin="2" Text="&#xe77f;"/>
												</StackPanel>
											</Button>

											<Button Command="{Binding PasteBelowElementsCommand}" 
													CommandParameter="{Binding ElementName=_listView, Path=SelectedIndex}"
													Style="{StaticResource ClipboardItemCountInRange}">
												<StackPanel Orientation="Vertical" HorizontalAlignment="Center">
													<TextBlock HorizontalAlignment="Center" FontFamily="{StaticResource SymbolFont}" FontSize="18" Margin="2" Text="&#xe77f;"/>
													<TextBlock HorizontalAlignment="Center" FontFamily="{StaticResource SymbolFont}" FontSize="12" Margin="2" Text="&#xe74b;"/>
												</StackPanel>
											</Button>

											<Button FontFamily="{StaticResource SymbolFont}"
													FontSize="18" Content="&#xe74d;" 
													Command="{Binding DeleteElementsCommand}"
													CommandParameter="{Binding ElementName=_listView, Path=SelectedItems}"
													Style="{StaticResource DeleteMultipleSelectionButton}"/>

											<Separator/>


											<Button FontFamily="{StaticResource SymbolFont}"
													FontSize="18" Content="&#xe74a;" 
													Command="{Binding MoveElementsUpCommand}"
													CommandParameter="{Binding ElementName=_listView}"
													Style="{StaticResource SingleSelectionButton}"/>

											<Button FontFamily="{StaticResource SymbolFont}"
													FontSize="18" Content="&#xe74b;" 
													Command="{Binding MoveElementsDownCommand}"
													CommandParameter="{Binding ElementName=_listView}"
													Style="{StaticResource SingleSelectionButton}"/>

											<Separator/>

											<Button FontFamily="{StaticResource SymbolFont}"
													FontSize="18" Content="&#xe721;" 
													Command="{Binding SearchElementsCommand}"/>
										</ToolBar>
										<ScrollViewer Grid.Row="1">
											<Grid>
												<Grid.ColumnDefinitions>
													<ColumnDefinition Width="auto"/>
													<ColumnDefinition Width="*"/>
												</Grid.ColumnDefinitions>

												<ListView Grid.Column="0" Margin="5" IsEnabled="False" 
														  ItemsSource="{Binding Indices}" 
														  Background="Transparent" 
														  BorderBrush="Transparent" 
														  SelectionMode="Multiple">
													<ListView.ItemTemplate>
														<DataTemplate>
															<Grid>
																<Grid.ColumnDefinitions>
																	<ColumnDefinition Width="auto"/>
																	<ColumnDefinition Width="auto"/>
																	<ColumnDefinition Width="auto"/>
																</Grid.ColumnDefinitions>
																<TextBlock FontFamily="Cascadia Mono" Grid.Column="0" VerticalAlignment="Center" Text="["/>
																<TextBlock FontFamily="Cascadia Mono" Grid.Column="1" VerticalAlignment="Center" Text="{Binding}"/>
																<TextBlock FontFamily="Cascadia Mono" Grid.Column="2" VerticalAlignment="Center" Text="]: "/>
															</Grid>
														</DataTemplate>
													</ListView.ItemTemplate>
												</ListView>
												<ListView x:Name="_listView" Grid.Column="1" Margin="5" 
														  ItemsSource="{Binding Elements}"
														  Resources="{StaticResource NodeCompactDataTemplates}" SelectedItem="{Binding SelectedNode, Mode=TwoWay}">
													<ListView.ItemContainerStyle>
														<Style TargetType="{x:Type ListViewItem}" BasedOn="{StaticResource {x:Type ListViewItem}}">
															<Setter Property="VerticalContentAlignment" Value="Center"/>
															<Setter Property="VerticalAlignment" Value="Center"/>
															<EventSetter Event="MouseDoubleClick" Handler="ArrayViewItem_MouseDoubleClick"/>
														</Style>
													</ListView.ItemContainerStyle>
												</ListView>
											</Grid>
										</ScrollViewer>
									</Grid>
								</DataTemplate>
								<DataTemplate DataType="{x:Type viewmodelnodes:ObjectNodeViewModel}">
									<ListView ItemsSource="{Binding Nodes}">
										<ListView.ItemContainerStyle>
											<Style TargetType="{x:Type ListViewItem}" BasedOn="{StaticResource {x:Static GridView.GridViewItemContainerStyleKey}}">
												<Setter Property="VerticalContentAlignment" Value="Center"/>
												<Setter Property="VerticalAlignment" Value="Center"/>
												<EventSetter Event="MouseDoubleClick" Handler="ObjectViewItem_MouseDoubleClick"/>
											</Style>
										</ListView.ItemContainerStyle>
										<ListView.View>
											<GridView>
												<GridView.Columns>
													<GridViewColumn Width="auto" Header="Property Name">
														<GridViewColumn.CellTemplate>
															<DataTemplate>
																<StackPanel Orientation="Horizontal" VerticalAlignment="Center">
																	<TextBlock VerticalAlignment="Center" FontFamily="Cascadia Mono" 
																			   FontWeight="Bold" FontSize="16" Text="{Binding Key}"/>
																	<TextBlock VerticalAlignment="Center" FontFamily="Cascadia Mono" 
																			   FontWeight="Bold" FontSize="16" Text=": "/>
																</StackPanel>
															</DataTemplate>
														</GridViewColumn.CellTemplate>
													</GridViewColumn>
													<GridViewColumn Width="auto" Header="Value">
														<GridViewColumn.CellTemplate>
															<DataTemplate>
																<ContentControl VerticalAlignment="Center" Content="{Binding Value}" 
																				Resources="{StaticResource NodeCompactDataTemplates}"/>
															</DataTemplate>
														</GridViewColumn.CellTemplate>
													</GridViewColumn>
												</GridView.Columns>
											</GridView>
										</ListView.View>	
									</ListView>
								</DataTemplate>
							</ContentControl.Resources>
						</ContentControl>
					</Grid>
				</DataTemplate>
			</TabControl.ContentTemplate>
		</TabControl>
    </Grid>
</local:CustomWindow>
