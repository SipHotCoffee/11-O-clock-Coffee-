<editor:CustomWindow x:Class="CG.Test.Editor.Views.MultipleOperationView"
                     xmlns:editor="clr-namespace:CG.Test.Editor"
                     xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                     xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                     xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                     xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                     xmlns:local="clr-namespace:CG.Test.Editor.Views" 
                     xmlns:viewmodels="clr-namespace:CG.Test.Editor.ViewModels"
                     xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
                     xmlns:system="clr-namespace:System;assembly=netstandard"
                     mc:Ignorable="d"
                     Title="Find and Replace" Width="800" Height="600" WindowStartupLocation="CenterScreen">
    <Window.DataContext>
        <viewmodels:MultipleOperationViewModel/>
    </Window.DataContext>
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <editor:ValueToTextConverter x:Key="ValueToTextConverter"/>
        <editor:IsNullConverter x:Key="IsNullConverter"/>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="auto"/>
        </Grid.RowDefinitions>

        <Button Grid.Row="0" Content="Select Type Filter" Margin="5, 5, 5, 2.5" Command="{Binding OpenTypePickerDialogCommand}"/>

        <TextBlock Grid.Row="1" Text="{Binding SelectedType.Name}" Margin="5"/>

        <TreeView x:Name="_treeView" Grid.Row="2" Margin="5, 2.5, 5, 2.5" ItemsSource="{Binding FieldNodes}">
            <i:Interaction.Triggers>
                <i:EventTrigger EventName="SelectedItemChanged">
                    <i:InvokeCommandAction CommandParameter="{Binding ElementName=_treeView, Path=SelectedItem}" Command="{Binding SelectCommand}"/>
                </i:EventTrigger>
            </i:Interaction.Triggers>
            <TreeView.Resources>
                <HierarchicalDataTemplate DataType="{x:Type viewmodels:FieldNode}" ItemsSource="{Binding Children}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto"/>
                            <ColumnDefinition Width="auto"/>
                            <ColumnDefinition Width="auto"/>
                        </Grid.ColumnDefinitions>
                        <Label Grid.Column="0" Content="{Binding Field.Name}"/>
                        <Label Grid.Column="1" Content=": "/>
                        <Label Grid.Column="2" Content="{Binding Field.Type}" FontWeight="Bold"/>
                    </Grid>
                </HierarchicalDataTemplate>
            </TreeView.Resources>
        </TreeView>

        <Grid Grid.Row="3" Visibility="{Binding ReplaceControlsVisibility}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Grid.RowDefinitions>
                <RowDefinition Height="auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <CheckBox x:Name="_replaceAllCheckBox" Margin="5, 2.5, 2.5, 2.5" Grid.Row="0" IsChecked="{Binding HasOldValue}" Content="Filter by value" VerticalAlignment="Center"/>

            <Button Margin="5, 2.5, 2.5, 5" Grid.Row="1" Grid.Column="0" IsEnabled="{Binding HasOldValue}" Command="{Binding ProcessOldValueCommand}">
                <Button.Content>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="Old Value: " VerticalAlignment="Center"/>
                        <TextBlock VerticalAlignment="Center">
                            <TextBlock.Text>
                                <MultiBinding Converter="{StaticResource ValueToTextConverter}">
                                    <MultiBinding.Bindings>
                                        <Binding Path="OldValue.Value"/>
                                        <Binding Path="OldValue.Type"/>
                                        <Binding Path="OldValue.Tree"/>
                                    </MultiBinding.Bindings>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                    </StackPanel>
                </Button.Content>
            </Button>
            <Button Margin="2.5, 2.5, 5, 5" Grid.Row="1" Grid.Column="1" Command="{Binding ProcessNewValueCommand}">
                <Button.Content>
                    <StackPanel Orientation="Horizontal"  VerticalAlignment="Center">
                        <TextBlock Text="New Value: " VerticalAlignment="Center"/>
                        <TextBlock VerticalAlignment="Center">
                            <TextBlock.Text>
                                <MultiBinding Converter="{StaticResource ValueToTextConverter}">
                                    <MultiBinding.Bindings>
                                        <Binding Path="NewValue.Value"/>
                                        <Binding Path="NewValue.Type"/>
                                        <Binding Path="NewValue.Tree"/>
                                    </MultiBinding.Bindings>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>
                    </StackPanel>
                </Button.Content>
            </Button>
        </Grid>

        <Grid Grid.Row="4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0" Content="Replace" Margin="5, 2.5, 2.5, 5" IsDefault="True" Command="{Binding ReplaceCommand}">
                <Button.IsEnabled>
                    <Binding Path="SelectedFieldNode" Converter="{StaticResource IsNullConverter}">
                        <Binding.ConverterParameter>
                            <system:Boolean>False</system:Boolean>
                        </Binding.ConverterParameter>
                    </Binding>
                </Button.IsEnabled>
            </Button>
            <Button Grid.Column="1" Content="Close" Margin="2.5, 2.5, 5, 5" IsCancel="True"/>
        </Grid>
    </Grid>
</editor:CustomWindow>
