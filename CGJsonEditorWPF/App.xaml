<Application x:Class="CG.Test.Editor.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:local="clr-namespace:CG.Test.Editor"
             xmlns:dialogs="clr-namespace:CG.Test.Editor.Json.Dialogs"
             xmlns:views="clr-namespace:CG.Test.Editor.Views"
             xmlns:viewmodelnodes="clr-namespace:CG.Test.Editor.Views"
             xmlns:viewmodels="clr-namespace:CG.Test.Editor.ViewModels">
    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Resources/Styles/Modern/ColorSchemes/Dark.xaml"/>
                <ResourceDictionary Source="Resources/Styles/Modern/Modern.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>

            <ResourceDictionary x:Key="BottomLevel">
                <DataTemplate DataType="{x:Type viewmodels:ArrayNodeViewModel}">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="{Binding Node.Type.ElementType.Name}"/>
                        <TextBlock Text="["/>
                        <TextBlock Text="{Binding Count}"/>
                        <TextBlock Text="]"/>
                    </StackPanel>
                </DataTemplate>

                <DataTemplate DataType="{x:Type viewmodels:ObjectNodeViewModel}">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="{Binding Node.Type.Name}"/>
                        <TextBlock Text="{} {"/>
                        <TextBlock Text="{Binding Name}" Visibility="{Binding Name, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                        <TextBlock Text="{}...}"/>
                    </StackPanel>
                </DataTemplate>
            </ResourceDictionary>

            <ResourceDictionary x:Key="TopLevel">
                <DataTemplate DataType="{x:Type viewmodels:ArrayNodeViewModel}">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="{Binding Node.Type.ElementType.Name}"/>
                        <TextBlock Text="["/>
                        <TextBlock Text="{Binding Count}"/>
                        <TextBlock Text="]"/>
                        <TextBlock Text="{} { "/>

                        <ItemsControl Resources="{StaticResource BottomLevel}" ItemsSource="{Binding Elements}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock x:Name="commaTextBlock" Text=", "/>
                                        <ContentPresenter Content="{Binding}"/>
                                    </StackPanel>
                                    <DataTemplate.Triggers>
                                        <DataTrigger Binding="{Binding RelativeSource={RelativeSource PreviousData}}" Value="{x:Null}">
                                            <Setter Property="Visibility" TargetName="commaTextBlock" Value="Collapsed"/>
                                        </DataTrigger>
                                    </DataTemplate.Triggers>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <TextBlock Text="{} }"/>
                    </StackPanel>
                </DataTemplate>


                <DataTemplate DataType="{x:Type viewmodels:ObjectNodeViewModel}">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="{Binding Node.Type.Name}"/>
                        <TextBlock Text="{} { "/>
                        <ItemsControl Resources="{StaticResource BottomLevel}" ItemsSource="{Binding Nodes}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock x:Name="commaTextBlock" Text=", "/>
                                        <ContentPresenter Content="{Binding Value}"/>
                                    </StackPanel>
                                    <DataTemplate.Triggers>
                                        <DataTrigger Binding="{Binding RelativeSource={RelativeSource PreviousData}}" Value="{x:Null}">
                                            <Setter Property="Visibility" TargetName="commaTextBlock" Value="Collapsed"/>
                                        </DataTrigger>
                                    </DataTemplate.Triggers>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <TextBlock Text="{} }"/>
                    </StackPanel>
                </DataTemplate>
                <DataTemplate DataType="{x:Type viewmodels:ValueNodeViewModel}">
                    <TextBlock Text="{Binding Value}"/>
                </DataTemplate>
            </ResourceDictionary>

            <Style TargetType="{x:Type views:MainWindow}"                   BasedOn="{StaticResource BaseWindowStyle}"/>
            <Style TargetType="{x:Type views:MultipleOperationView}"        BasedOn="{StaticResource BaseWindowStyle}"/>
            <Style TargetType="{x:Type views:ArrayElementSearchDialogView}" BasedOn="{StaticResource BaseWindowStyle}"/>
            <!--<Style TargetType="{x:Type views:TypePickerDialog}"             BasedOn="{StaticResource BaseWindowStyle}"/>-->
            <Style TargetType="{x:Type views:StructTypePickerView}"         BasedOn="{StaticResource BaseWindowStyle}"/>
            <Style TargetType="{x:Type views:InstanceTypePickerDialogView}" BasedOn="{StaticResource BaseWindowStyle}"/>
            <Style TargetType="{x:Type views:AcceptedNamesDialog}"          BasedOn="{StaticResource BaseWindowStyle}"/>
            <Style TargetType="{x:Type views:ObjectMismatchDialog}"         BasedOn="{StaticResource BaseWindowStyle}"/>
            <!--<Style TargetType="{x:Type viewsnodes:EnumValueDialogView}"     BasedOn="{StaticResource BaseWindowStyle}"/>-->
            <Style TargetType="{x:Type dialogs:NumericValueDialog}"         BasedOn="{StaticResource BaseWindowStyle}"/>
            <Style TargetType="{x:Type dialogs:ReferenceDialog}"            BasedOn="{StaticResource BaseWindowStyle}"/>
            <Style TargetType="{x:Type dialogs:StringValueDialogView}"      BasedOn="{StaticResource BaseWindowStyle}"/>
            <Style TargetType="{x:Type views:TypeMissingDialogView}"        BasedOn="{StaticResource BaseWindowStyle}"/>
        </ResourceDictionary>
    </Application.Resources>
</Application>
