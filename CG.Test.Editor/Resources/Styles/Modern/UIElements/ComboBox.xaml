<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="Window.xaml"/>
    </ResourceDictionary.MergedDictionaries>

    <SolidColorBrush x:Key="ComboBox.Normal.Background" Color="{StaticResource Control2}"/>
    <LinearGradientBrush x:Key="ComboBox.Normal.Border" StartPoint="0, 0" EndPoint="0, 1">
        <LinearGradientBrush.GradientStops>
            <GradientStop Color="{StaticResource Control5}" Offset="0.05"/>
            <GradientStop Color="{StaticResource Control3}" Offset="0.1"/>
        </LinearGradientBrush.GradientStops>
    </LinearGradientBrush>

    <SolidColorBrush x:Key="ComboBox.MouseOver.Background" Color="{StaticResource Control3}"/>
    <LinearGradientBrush x:Key="ComboBox.MouseOver.Border" StartPoint="0, 0" EndPoint="0, 1">
        <LinearGradientBrush.GradientStops>
            <GradientStop Color="{StaticResource Control7}" Offset="0.05"/>
            <GradientStop Color="{StaticResource Control4}" Offset="0.1"/>
        </LinearGradientBrush.GradientStops>
    </LinearGradientBrush>

    <SolidColorBrush x:Key="ComboBox.Pressed.Background" Color="{StaticResource Control1}"/>
    <LinearGradientBrush x:Key="ComboBox.Pressed.Border" StartPoint="0, 0" EndPoint="0, 1">
        <LinearGradientBrush.GradientStops>
            <GradientStop Color="{StaticResource Control2}" Offset="0.05"/>
            <GradientStop Color="{StaticResource Control2}" Offset="0.1"/>
        </LinearGradientBrush.GradientStops>
    </LinearGradientBrush>


    <SolidColorBrush x:Key="ComboBoxToggleButton.Normal.Background" Color="{StaticResource Control2}"/>
    <LinearGradientBrush x:Key="ComboBoxToggleButton.Normal.Border" StartPoint="0, 0" EndPoint="0, 1">
        <LinearGradientBrush.GradientStops>
            <GradientStop Color="{StaticResource Control5}" Offset="0.05"/>
            <GradientStop Color="{StaticResource Control3}" Offset="0.1"/>
        </LinearGradientBrush.GradientStops>
    </LinearGradientBrush>

    <SolidColorBrush x:Key="ComboBoxToggleButton.MouseOver.Background" Color="{StaticResource Control3}"/>
    <LinearGradientBrush x:Key="ComboBoxToggleButton.MouseOver.Border" StartPoint="0, 0" EndPoint="0, 1">
        <LinearGradientBrush.GradientStops>
            <GradientStop Color="{StaticResource Control7}" Offset="0.05"/>
            <GradientStop Color="{StaticResource Control4}" Offset="0.1"/>
        </LinearGradientBrush.GradientStops>
    </LinearGradientBrush>

    <SolidColorBrush x:Key="ComboBoxToggleButton.Pressed.Background" Color="{StaticResource Control1}"/>
    <LinearGradientBrush x:Key="ComboBoxToggleButton.Pressed.Border" StartPoint="0, 0" EndPoint="0, 1">
        <LinearGradientBrush.GradientStops>
            <GradientStop Color="{StaticResource Control2}" Offset="0.05"/>
            <GradientStop Color="{StaticResource Control2}" Offset="0.1"/>
        </LinearGradientBrush.GradientStops>
    </LinearGradientBrush>

    <SolidColorBrush x:Key="ComboBoxItem.MouseOver.Background" Color="{StaticResource Control2}"/>
    <LinearGradientBrush x:Key="ComboBoxItem.MouseOver.Border" StartPoint="0, 0" EndPoint="0, 1">
        <LinearGradientBrush.GradientStops>
            <GradientStop Color="{StaticResource Control5}" Offset="0.05"/>
            <GradientStop Color="{StaticResource Control3}" Offset="0.1"/>
        </LinearGradientBrush.GradientStops>
    </LinearGradientBrush>

    <SolidColorBrush x:Key="ComboBoxItem.Selected.Background" Color="{StaticResource Control1}"/>
    <SolidColorBrush x:Key="ComboBoxItem.Selected.Border"     Color="{StaticResource Control2}"/>

    <SolidColorBrush x:Key="ComboBoxItem.SelectionHighlight.Border" Color="{StaticResource Accent4}"/>

    <Style x:Key="ComboBoxToggleButtonStyle" TargetType="{x:Type ToggleButton}">
        <Setter Property="Background"      Value="{StaticResource ComboBoxToggleButton.Normal.Background}"/>
        <Setter Property="BorderBrush"     Value="{StaticResource ComboBoxToggleButton.Normal.Border}"/>
        <Setter Property="Foreground"      Value="{StaticResource Window.Active.Foreground}"/>
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="Padding"         Value="12"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ToggleButton}">
                    <Border Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="4" 
                            Padding="{TemplateBinding Padding}"
                            SnapsToDevicePixels="True">
                        <ContentPresenter x:Name="_contentPresenter"
                                          HorizontalAlignment="Center" 
                                          VerticalAlignment="Center"
                                          Content="{TemplateBinding Content}"/>
                    </Border>

                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background"  Value="{StaticResource ComboBoxToggleButton.MouseOver.Background}"/>
                            <Setter Property="BorderBrush" Value="{StaticResource ComboBoxToggleButton.MouseOver.Border}"/>
                        </Trigger>

                        <Trigger Property="IsPressed" Value="True">
                            <Setter Property="Background"  Value="{StaticResource ComboBoxToggleButton.Pressed.Background}"/>
                            <Setter Property="BorderBrush" Value="{StaticResource ComboBoxToggleButton.Pressed.Border}"/>
                        </Trigger>

                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>


    <ControlTemplate x:Key="ComboBoxTemplate" TargetType="{x:Type ComboBox}">

        <Grid HorizontalAlignment="Stretch">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="auto"/>
            </Grid.ColumnDefinitions>
            <ToggleButton x:Name="_toggleButton"
                          Grid.ColumnSpan="2"
                          HorizontalAlignment="Stretch"
                          HorizontalContentAlignment="Stretch"
                          Background="{TemplateBinding Background}"
                          BorderBrush="{TemplateBinding BorderBrush}" 
                          BorderThickness="1" 
                          Padding="8"
                          Style="{StaticResource ComboBoxToggleButtonStyle}"
                          IsChecked="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=IsDropDownOpen, Mode=TwoWay}">
                <ContentPresenter Content="{TemplateBinding SelectedItem}" ContentTemplate="{TemplateBinding ItemTemplate}"/>
            </ToggleButton>
            <TextBlock x:Name="_upDownGlyph" Margin="4" Grid.Column="1" FontFamily="{StaticResource SymbolFont}" Text="&#xE70D;" HorizontalAlignment="Right" VerticalAlignment="Center"/>

            <Popup x:Name="_popup" 
                    Grid.ColumnSpan="2"
                    IsOpen="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=IsDropDownOpen, Mode=OneWay}"
                    Width ="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=ActualWidth   , Mode=OneWay}"
                    AllowsTransparency="True"
                    Placement="Bottom"
                    PlacementTarget="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}}"
                    Focusable="False">
                <Border Background="{StaticResource Window.Active.Background}" BorderThickness="1" CornerRadius="4">
                    <Border.BorderBrush>
                        <SolidColorBrush Color="White" Opacity="0.1"/>
                    </Border.BorderBrush>
                    <ScrollViewer>
                        <ItemsPresenter/>
                    </ScrollViewer>
                </Border>

            </Popup>
        </Grid>
        <ControlTemplate.Triggers>
            <Trigger Property="IsMouseOver" Value="True">
                <Setter Property="Background"  Value="{StaticResource ComboBox.MouseOver.Background}"/>
                <Setter Property="BorderBrush" Value="{StaticResource ComboBox.MouseOver.Border}"/>
            </Trigger>

            <Trigger Property="IsDropDownOpen" Value="True">
                <Setter TargetName="_upDownGlyph" Property="Text" Value="&#xE70E;"/>
            </Trigger>
        </ControlTemplate.Triggers>
    </ControlTemplate>

    <ControlTemplate x:Key="EditableComboBoxTemplate" TargetType="{x:Type ComboBox}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="auto"/>
            </Grid.ColumnDefinitions>
            <TextBox x:Name="PART_EditableTextBox" 
                     Grid.Column="0"
                     Grid.ColumnSpan="2"
                     Text="{TemplateBinding Text}" 
                     IsReadOnly="{TemplateBinding IsReadOnly}" 
                     Focusable="True">
            </TextBox>

            <ToggleButton x:Name="_upDownGlyph" Grid.Column="1" FontFamily="{StaticResource SymbolFont}" Content="&#xE70D;" HorizontalAlignment="Center" VerticalAlignment="Center" 
                          Style="{StaticResource ComboBoxToggleButtonStyle}"
                          IsChecked="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=IsDropDownOpen, Mode=TwoWay}"/>

            <Popup x:Name="_popup" 
                   Grid.ColumnSpan="2"
                   IsOpen="{TemplateBinding IsDropDownOpen}"
                   Width ="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}, Path=ActualWidth, Mode=OneWay}"
                   AllowsTransparency="True"
                   Placement="Bottom"
                   PlacementTarget="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}}"
                   Focusable="False">
                <Border Background="{StaticResource Window.Active.Background}" BorderThickness="1" CornerRadius="4">
                    <Border.BorderBrush>
                        <SolidColorBrush Color="White" Opacity="0.1"/>
                    </Border.BorderBrush>
                    <ScrollViewer>
                        <ItemsPresenter/>
                    </ScrollViewer>
                </Border>

            </Popup>
        </Grid>
    </ControlTemplate>
    
    <Style TargetType="{x:Type ComboBox}">
        <Setter Property="Background"  Value="{StaticResource ComboBox.Normal.Background}"/>
        <Setter Property="BorderBrush" Value="{StaticResource ComboBox.Normal.Border}"/>
        <Setter Property="Foreground"  Value="{StaticResource Window.Active.Foreground}"/>

        <Setter Property="Template" Value="{StaticResource ComboBoxTemplate}"/>

        <Style.Triggers>
            <Trigger Property="IsEditable" Value="True">
                <Setter Property="Template" Value="{StaticResource EditableComboBoxTemplate}"/>
            </Trigger>
        </Style.Triggers>
    </Style>

    <Style TargetType="{x:Type ComboBoxItem}">
        <Setter Property="Background"      Value="Transparent"/>
        <Setter Property="BorderBrush"     Value="Transparent"/>
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="Foreground"      Value="{StaticResource Window.Active.Foreground}"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type ComboBoxItem}">
                    <Grid SnapsToDevicePixels="True">
                        <Border x:Name="SelectionBorder" 
                                HorizontalAlignment="Left" 
                                Margin="5, 10, 3, 10" 
                                CornerRadius="1.5" 
                                Width="3"
                                Visibility="Hidden" 
                                Background="{StaticResource ComboBoxItem.SelectionHighlight.Border}"/>
                        
                        <Border Padding="8"
                                Margin="3"
                                CornerRadius="3"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}">        
                            <ContentPresenter/>
                        </Border>
                    </Grid>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background"  Value="{StaticResource ComboBoxItem.MouseOver.Background}"/>
                            <Setter Property="BorderBrush" Value="{StaticResource ComboBoxItem.MouseOver.Border}"/>
                        </Trigger>

                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background"  Value="{StaticResource ComboBoxItem.Selected.Background}"/>
                            <Setter Property="BorderBrush" Value="{StaticResource ComboBoxItem.Selected.Border}"/>
                            <Setter TargetName="SelectionBorder" Property="Visibility" Value="Visible"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>